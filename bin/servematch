#!/usr/bin/env bash
set -euvxo pipefail
len=$1
vals=$2
let ctx=len*2
dir=$(mktemp -d)
trap 'rm -rf $dir' EXIT
fifo=$dir/fifo
mkfifo $fifo
export PYTHONUNBUFFERED=1
http < $fifo | match $vals | stdbuf -o0 awk -v n=$len '{ print $1 + n * 2 }' | ctx $ctx $vals > $fifo
