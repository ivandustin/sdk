#!/usr/bin/env python
from contextlib import suppress
from sys import argv, stdin
from numpy import array, arange, full, concatenate
from numpy.random import choice
from learn.batch.decode import decode
from learn.batch.encode import encode

size = int(argv[1])
xs = []
ys = []
for line in stdin:
    x, y = decode(line)
    xs.append(x)
    ys.append(y)
x = array(xs)
y = array(ys)
g = []
for i in range(y.max() + 1):
    g.append(x[y == i])
size = size // len(g)
with suppress(KeyboardInterrupt, BrokenPipeError):
    while True:
        xs = []
        ys = []
        for i, x in enumerate(g):
            indices = arange(x.shape[0])
            indices = choice(indices, size=size)
            x = x[indices]
            y = full((size,), i)
            xs.append(x)
            ys.append(y)
        x = concatenate(xs)
        y = concatenate(ys)
        print(encode(x, y))
